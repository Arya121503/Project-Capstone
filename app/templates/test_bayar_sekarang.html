<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Bayar Sekarang Button</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h3>Test Tombol Bayar Sekarang</h3>
        
        <div id="testContainer"></div>
        
        <div class="mt-4">
            <button class="btn btn-primary" onclick="testApprovedRequest()">Test Approved Request</button>
            <button class="btn btn-secondary" onclick="testPendingRequest()">Test Pending Request</button>
        </div>
        
        <div class="mt-4">
            <h5>Console Output:</h5>
            <pre id="consoleOutput" class="bg-light p-3" style="height: 300px; overflow-y: auto;"></pre>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function log(message) {
            const output = document.getElementById('consoleOutput');
            output.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }
        
        function renderRequestCard(request) {
            // Format created date
            const createdDate = new Date(request.created_at);
            const formattedCreatedDate = createdDate.toLocaleDateString('id-ID', { 
                day: 'numeric', 
                month: 'long', 
                year: 'numeric' 
            });
            
            // Status badge
            let statusBadge = '';
            switch (request.status) {
                case 'pending':
                    statusBadge = '<span class="badge bg-warning text-dark">Menunggu</span>';
                    break;
                case 'approved':
                    statusBadge = '<span class="badge bg-success">Disetujui</span>';
                    break;
                case 'active':
                    statusBadge = '<span class="badge bg-primary">Aktif</span>';
                    break;
                case 'rejected':
                    statusBadge = '<span class="badge bg-danger">Ditolak</span>';
                    break;
                case 'completed':
                    statusBadge = '<span class="badge bg-secondary">Selesai</span>';
                    break;
                default:
                    statusBadge = '<span class="badge bg-secondary">Unknown</span>';
            }
            
            // Action buttons based on status
            let actionButtons = '';
            log(`Processing request ${request.id} with status: ${request.status}`);
            
            if (request.status === 'pending') {
                actionButtons = `
                    <button class="btn btn-sm btn-outline-danger" onclick="cancelRentalRequest(${request.id})">
                        <i class="fas fa-times me-1"></i>Batalkan
                    </button>
                `;
                log(`Added Cancel button for request ${request.id}`);
            } else if (request.status === 'approved') {
                actionButtons = `
                    <button class="btn btn-sm btn-success" onclick="payRentalRequest(${request.id})">
                        <i class="fas fa-credit-card me-1"></i>Bayar Sekarang
                    </button>
                `;
                log(`Added Bayar Sekarang button for request ${request.id}`);
            }
            
            return `
                <div class="card mb-3">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div>
                            <strong>Pengajuan #${request.id}</strong>
                            <small class="text-muted ms-2">${formattedCreatedDate}</small>
                        </div>
                        <div>
                            ${statusBadge}
                        </div>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title">${request.asset_name || 'Unknown Asset'}</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <p class="mb-1"><strong>Tanggal Mulai:</strong> ${request.tanggal_mulai || 'N/A'}</p>
                                <p class="mb-1"><strong>Tanggal Berakhir:</strong> ${request.tanggal_selesai || 'N/A'}</p>
                            </div>
                            <div class="col-md-6">
                                <p class="mb-1"><strong>Durasi:</strong> ${request.durasi_sewa || 0} bulan</p>
                                <p class="mb-1"><strong>Total Harga:</strong> Rp ${new Intl.NumberFormat('id-ID').format(request.total_harga || 0)}</p>
                            </div>
                        </div>
                        
                        <div class="mt-3 d-flex gap-2">
                            ${actionButtons}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function testApprovedRequest() {
            log('Testing approved request...');
            const approvedRequest = {
                id: 48,
                status: 'approved',
                asset_name: 'Bangunan Surabaya Selatan 6',
                tanggal_mulai: '2025-09-01',
                tanggal_selesai: '2027-08-22',
                durasi_sewa: 24,
                total_harga: 19103736,
                created_at: '2025-08-02T07:10:13'
            };
            
            document.getElementById('testContainer').innerHTML = renderRequestCard(approvedRequest);
        }
        
        function testPendingRequest() {
            log('Testing pending request...');
            const pendingRequest = {
                id: 52,
                status: 'pending',
                asset_name: 'Gudang Penyimpanan Gubeng',
                tanggal_mulai: '2025-08-28',
                tanggal_selesai: '2026-08-23',
                durasi_sewa: 12,
                total_harga: 249825132,
                created_at: '2025-08-03T16:31:58'
            };
            
            document.getElementById('testContainer').innerHTML = renderRequestCard(pendingRequest);
        }
        
        function payRentalRequest(requestId) {
            log(`Bayar Sekarang clicked for request ${requestId}`);
            alert(`Payment function called for request ${requestId}`);
        }
        
        function cancelRentalRequest(requestId) {
            log(`Cancel clicked for request ${requestId}`);
            alert(`Cancel function called for request ${requestId}`);
        }
        
        // Test on page load
        window.onload = function() {
            log('Page loaded, testing approved request by default');
            testApprovedRequest();
        };
    </script>
</body>
</html>
