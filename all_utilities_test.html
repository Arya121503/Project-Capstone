
<!DOCTYPE html>
<html>
<head>
    <title>All Utilities Fix Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .test-container { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <h1>üß™ All Utilities Fix Verification</h1>
    <div class="test-container">
        <h2>Test Results</h2>
        <div id="test-output"></div>
    </div>
    
    <div class="test-container">
        <h2>Sample Asset with Formatting</h2>
        <div id="sample-output"></div>
    </div>
    
    <script src="http://127.0.0.1:5000/static/js/sewakan_aset_new.js?v=20250803120000"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const output = document.getElementById('test-output');
            const sampleOutput = document.getElementById('sample-output');
            
            try {
                // Test all utility functions
                const tests = [
                    {
                        name: 'escapeHtml',
                        test: () => {
                            if (typeof escapeHtml === 'function') {
                                const result = escapeHtml('<script>alert("test")</script>');
                                return result.includes('&lt;') && result.includes('&gt;');
                            }
                            return false;
                        }
                    },
                    {
                        name: 'formatCurrency',
                        test: () => {
                            if (typeof formatCurrency === 'function') {
                                const result = formatCurrency(1500000);
                                return result.includes('1.500.000') || result.includes('1,500,000');
                            }
                            return false;
                        }
                    },
                    {
                        name: 'formatDate',
                        test: () => {
                            if (typeof formatDate === 'function') {
                                const result = formatDate('2025-08-03');
                                return result.length > 5 && !result.includes('Invalid');
                            }
                            return false;
                        }
                    },
                    {
                        name: 'showNotification',
                        test: () => {
                            if (typeof showNotification === 'function') {
                                const notification = showNotification('Test notification', 'success', false);
                                if (notification) {
                                    notification.remove(); // Clean up
                                    return true;
                                }
                            }
                            return false;
                        }
                    },
                    {
                        name: 'RentalAssetManager',
                        test: () => {
                            return typeof RentalAssetManager === 'function';
                        }
                    }
                ];
                
                tests.forEach(test => {
                    try {
                        const result = test.test();
                        const status = result ? '‚úÖ' : '‚ùå';
                        const className = result ? 'success' : 'error';
                        output.innerHTML += `<p class="${className}">${status} ${test.name}: ${result ? 'Working' : 'Failed'}</p>`;
                    } catch (error) {
                        output.innerHTML += `<p class="error">‚ùå ${test.name}: Error - ${error.message}</p>`;
                    }
                });
                
                // Test sample asset rendering with all formatting
                const sampleAsset = {
                    id: 1,
                    name: 'Test Asset <script>alert("hack")</script>',
                    kecamatan: 'Surabaya',
                    alamat: 'Jl. Test & Co.',
                    harga_sewa: 1500000,
                    created_at: '2025-08-03T10:00:00Z'
                };
                
                sampleOutput.innerHTML = `
                    <table border="1" style="width: 100%; border-collapse: collapse;">
                        <tr>
                            <th>Field</th>
                            <th>Original</th>
                            <th>Formatted</th>
                        </tr>
                        <tr>
                            <td>Name</td>
                            <td>${sampleAsset.name}</td>
                            <td>${escapeHtml(sampleAsset.name)}</td>
                        </tr>
                        <tr>
                            <td>Harga Sewa</td>
                            <td>${sampleAsset.harga_sewa}</td>
                            <td>Rp ${formatCurrency(sampleAsset.harga_sewa)}</td>
                        </tr>
                        <tr>
                            <td>Created At</td>
                            <td>${sampleAsset.created_at}</td>
                            <td>${formatDate(sampleAsset.created_at)}</td>
                        </tr>
                    </table>
                `;
                
            } catch (error) {
                output.innerHTML += `<p class="error">‚ùå General Error: ${error.message}</p>`;
                console.error('Test failed:', error);
            }
        });
    </script>
</body>
</html>
    